<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  <script>
    let data = null;
    fetch('../database/all.bin')
      .then(response => response.arrayBuffer())
      .then(buffer => data = buffer)
      .then(() => {
        const now = new Date();
        getData(now.getFullYear(), now.getMonth(), now.getDate());
      });

    function getData(year, month, date) {
      const count = (new Date(year, month, date) - new Date(1901, 0, 1)) / (1000 * 60 * 60 * 24);
      const dataView = new DataView(data, count * 5, 5);
      const [byte0, byte1, byte2, byte3, byte4] = [dataView.getUint8(0), dataView.getUint8(1), dataView.getUint8(2), dataView.getUint8(3), dataView.getUint8(4)];
      const _year = byte0;
      const _month = byte1 >>> 4;
      const _date = ((byte1 & 0x0F) << 1) + (byte2 >>> 7);
      const _tianGan = ((byte2 & 0x7F) >>> 3);
      const _diZhi = ((byte2 & 0x07) << 1) + byte3 >>> 7;
      const __month = (byte3 & 0x7F) >>> 3;
      const __date = ((byte3 & 0x07) << 2) + (byte4 >>> 6);
      const __leap = ((byte4 >>> 5) & 0x01) === 0x01;
      const __solarTerm = byte4 & 0x1F;

      console.log({
        year: _year + 1900,
        month: month + 1,
        date: _date,
        tianGan: _tianGan,
        diZhi: _diZhi,
        _month: __month,
        _date: __date,
        __leap,
        __solarTerm,
      });
    }
  </script>
</body>
</html>